<%- include('partials/header'); -%>

<form>

<h2>Update Note</h2>
<label for = "title">Title</label>
<input type = "text" name = "title" value="<%=note.title%>" required />
<div class = "title error"></div>
<label for = "description">Description</label>
<input type = "text" name = "description" value = "<%=note.description%>" required />
<div class = "description error"></div>
<button value = "<%=note._id%>">Update</button>

</form> 

<script>
    const form = document.querySelector("form")
    const button = document.querySelector("button")

    const titleError = document.querySelector(".title.error")
    const descriptionError = document.querySelector(".description.error")

    form.addEventListener("submit" , async(e)=>{

        e.preventDefault()


titleError.textContent = ""
descriptionError.textContent = ""

const title = form.title.value.trim()
const description = form.description.value.trim()
const id = button.value

    try{

        const res = await fetch(`/update-note/${id}` , {
            method:"POST",
            body:JSON.stringify({title , description}),
            headers:{"Content-Type":"application/json"}
        })

        const data = await res.json()
        console.log(data)

        if(data.errors)
        {
            titleError.textContent = data.errors.title
            descriptionError.textContent = data.errors.description
        }

        if(data.note)
        {
            location.assign("/notes")
        }



    }catch(err){
        console.log(err)
    }
    })

   
</script>


<%- include('partials/footer'); -%>
